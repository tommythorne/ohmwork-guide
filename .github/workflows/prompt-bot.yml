name: AI Prompt Bot

on:
  # lets you run it manually from the Actions tab (good for testing)
  workflow_dispatch:
    inputs:
      prompt:
        description: "Prompt to send to ChatGPT"
        required: true
  # triggered by your iOS Shortcut POST /dispatches
  repository_dispatch:
    types: [chatgpt_task]

permissions:
  contents: write

jobs:
  run-prompt:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Install bot deps
        run: npm install --prefix ./.ai-bot

      - name: Run AI Prompt Bot
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          # prefer Shortcut payload, fall back to manual input
          CHATGPT_PROMPT: ${{ github.event.client_payload.prompt || inputs.prompt }}
        run: node ./.ai-bot/prompt-bot.mjs
